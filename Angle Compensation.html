<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Angle Compensation</title>
  <link rel="stylesheet" href="style.css" />
    <style>

    .readout {
      margin: 20px auto;
      max-width: 300px;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      font-size: 1.2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .readout p {
      margin: 8px 0;
    }
    button {
      display: block;
      margin: 10px auto;
      padding: 10px 20px;
      font-size: 1rem;
      cursor: pointer;
    }
    #lockReadoutBtn {
      background: #ccc;
      border: none;
      border-radius: 4px;
    }
    #lockReadoutBtn:disabled,
    #resetBtn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Angle Compensation</h1>

    <label for="lineDistance">Straight-Line Distance to Target (yards):</label>
    <input type="number" id="lineDistance" placeholder="e.g., 500yds" />

    <label for="angle">Angle to Target (degrees):</label>
    <input type="number" id="angle" placeholder="e.g., -15 for downhill" />

    <button onclick="calculateTrueDistance()">Calculate Horizontal Distance</button>

    <div class="result" id="angleResult"></div>


    <hr />

    <h2>Digital Angle Readout</h2>
    <button id="startLevelBtn">Start Level</button>
    <button id="lockReadoutBtn" disabled>Lock Readout (3s)</button>
    <button id="resetBtn" disabled>Reset Readout</button>
    <div class="readout" id="angleReadout">
      <p>Roll: <span id="rollValue">0.0</span>°</p>
      <p>Pitch: <span id="pitchValue">0.0</span>°</p>
    </div>
  </div>

  <script>
    let orientationActive = false;

    function calculateTrueDistance() {
      const distance = parseFloat(document.getElementById("lineDistance").value);
      const angle = parseFloat(document.getElementById("angle").value);
      const resultBox = document.getElementById("angleResult");

      if (isNaN(distance) || isNaN(angle)) {
        resultBox.innerText = "Please enter valid numbers.";
        return;
      }

      const radians = angle * (Math.PI / 180);
      const horizontal = distance * Math.cos(radians);
      resultBox.innerText = `True horizontal distance: ${horizontal.toFixed(1)} yards`;
    }

    async function enableMotion() {
      if (typeof DeviceMotionEvent !== "undefined" &&
          typeof DeviceMotionEvent.requestPermission === "function") {
        const resp = await DeviceMotionEvent.requestPermission();
        if (resp !== "granted") throw new Error("Motion permission denied");
      }
    }

    function onOrient(e) {
      const roll = e.gamma;
      const pitch = e.beta;
      document.getElementById("rollValue").textContent = roll.toFixed(1);
      document.getElementById("pitchValue").textContent = pitch.toFixed(1);
    }

    // Start level and enable lock
    document.getElementById("startLevelBtn").addEventListener("click", async () => {
      try {
        await enableMotion();
        if (!orientationActive) {
          window.addEventListener("deviceorientation", onOrient);
          orientationActive = true;
        }
        document.getElementById("startLevelBtn").disabled = true;
        document.getElementById("lockReadoutBtn").disabled = false;
      } catch (e) {
        alert(e.message);
      }
    });

    // Lock the readout after 3 seconds
    document.getElementById("lockReadoutBtn").addEventListener("click", () => {
      const lockBtn = document.getElementById("lockReadoutBtn");
      lockBtn.disabled = true;
      setTimeout(() => {
        if (orientationActive) {
          window.removeEventListener("deviceorientation", onOrient);
          orientationActive = false;
        }
        document.getElementById("resetBtn").disabled = false;
        alert("Readout locked.");
      }, 3000);
    });

    // Reset to allow new measurement
    document.getElementById("resetBtn").addEventListener("click", async () => {
      document.getElementById("resetBtn").disabled = true;
      document.getElementById("startLevelBtn").disabled = false;
      document.getElementById("lockReadoutBtn").disabled = true;
      document.getElementById("rollValue").textContent = "0.0";
      document.getElementById("pitchValue").textContent = "0.0";
    });
  </script>
</body>
</html>
