<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Angle Compensation</title>
  <link rel="stylesheet" href="style.css" />
    <style>
    .level-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 20px auto;
      border: 4px solid #333;
      border-radius: 50%;
      background: #eee;
      overflow: hidden;
    }
    .bubble {
      position: absolute;
      width: 40px;
      height: 40px;
      background: rgba(0,200,0,0.6);
      border: 2px solid #060;
      border-radius: 50%;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      transition: top 0.1s, left 0.1s;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Angle Compensation</h1>

    <label for="lineDistance">Straight-Line Distance to Target (yards):</label>
    <input type="number" id="lineDistance" placeholder="e.g., 500" />

    <label for="angle">Angle to Target (degrees):</label>
    <input type="number" id="angle" placeholder="e.g., -15 for downhill" />

    <button onclick="calculateTrueDistance()">Calculate Horizontal Distance</button>

    <div class="result" id="angleResult"></div>


    <hr />

    <h2>Digital Bubble Level</h2>
    <button id="startLevelBtn">Start Level</button>
    <div class="level-container" id="levelContainer">
      <div class="bubble" id="bubble"></div>
    </div>

    <a href="index.html" class="back-link">‚Üê Home</a>

  </div>

  <script>
    function calculateTrueDistance() {
      const distance = parseFloat(document.getElementById("lineDistance").value);
      const angle = parseFloat(document.getElementById("angle").value);
      const resultBox = document.getElementById("angleResult");

      if (isNaN(distance) || isNaN(angle)) {
        resultBox.innerText = "Please enter valid numbers.";
        return;
      }

      const radians = angle * (Math.PI / 180);
      const horizontal = distance * Math.cos(radians);

      resultBox.innerText = `True horizontal distance: ${horizontal.toFixed(1)} yards`;
    }

    // Bubble level code
    async function enableMotion() {
      if (typeof DeviceMotionEvent !== "undefined" &&
          typeof DeviceMotionEvent.requestPermission === "function") {
        const resp = await DeviceMotionEvent.requestPermission();
        if (resp !== "granted") throw new Error("Motion permission denied");
      }
    }

    document.getElementById("startLevelBtn").addEventListener("click", async () => {
      try {
        await enableMotion();
        window.addEventListener("deviceorientation", onOrient);
        document.getElementById("startLevelBtn").style.display = "none";
      } catch (e) {
        alert(e.message);
      }
    });

    function onOrient(e) {
      const bubble = document.getElementById("bubble");
      const container = document.getElementById("levelContainer");
      const maxTilt = 30;
      let x = e.gamma;
      let y = e.beta;

      x = Math.max(-maxTilt, Math.min(maxTilt, x));
      y = Math.max(-maxTilt, Math.min(maxTilt, y));

      const cx = container.clientWidth / 2;
      const cy = container.clientHeight / 2;
      const radius = (container.clientWidth - bubble.clientWidth) / 2;

      const px = cx + (x / maxTilt) * radius;
      const py = cy + (y / maxTilt) * radius;

      bubble.style.left = px + "px";
      bubble.style.top  = py + "px";
    }
  </script>
</body>
</html>
